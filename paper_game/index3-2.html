<!DOCTYPE html>
<html>

<head id="myvideo">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>paper_game</title>
	<meta property="og:title" content="全民搶搶搶">
	<meta property="og:description" content="台北市6小時到貨(試營運)，全台灣24小時到貨！" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta name="format-detection" content="telephone=no">
	<meta name="format-detection" content="address=no">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, shrink-to-fit=no, user-scalable=0">
	<!--CSS-->
	<link type="text/css" rel="stylesheet" href="css/bootstrap.css">
	<link type="text/css" rel="stylesheet" href="css/animate.css">
	<link type="text/css" rel="stylesheet" href="css/magnific-popup.css">
	<link type="text/css" rel="stylesheet" href="css/allv1.css">
	<link type="text/css" rel="stylesheet" href="css/allv2.css">
	<link type="text/css" rel="stylesheet" href="css/allv3.css">
	<!-- <link type="text/css" rel="stylesheet" href="css/layout_1225.css">
	<link tpye="text/css" rel="stylesheet" href="css/all_1226v2.css"> -->
	<style>
		.clause_support,.img_support,.word_support{
			display: none;
		}
		#game2_next_btn,#game2_reset_btn,#game2_submit_btn{
			height:40px;
			margin: 0 5px;
		}
		.btn-outline-success.disabled, .btn-outline-success:disabled {
			color: #808080;
			background-color: #d4d4d4;
			border-color: #888;
		}
		#game2,#mission_score_box{
			display: none;
		}
		#game_score_box{
			display:block;
		}

		#data_v{
			border: 1px #000 solid;
    		padding: 1px 5px 10px 5px;
			height:60px;
			margin-top: 130px!important;
		}

		#game3_popup{
			display: none;
			position: absolute;
			z-index: 999999;
			background-color: #ffffffeb;
			width: 100%;
			height: 100%;
			top: 0px;
		}
		.cell img{
			width: 100%;
		}
		#game4_popup_img img{
			border: 2px solid black;
			box-shadow: inset 0 0 0 2px black, inset 6px 6px 0 rgba(30, 144, 255, 0.2), 3px 3px 0 rgba(30, 144, 255, 0.2);
			max-width: 375px!important;
		}	
	</style>
</head>

<body class="bg-light">
	<header class="blog-header py-3">
		<div class="container">
			<div class="row flex-nowrap justify-content-between align-items-center">
				<div class="col-4 text-left">
					<button type="button" class="btn btn-labeled btn-info">
						<span class="btn-label">賓果線：</span><span id="bingo_line"></span><span>條</span>
					</button>
				</div>
				<div>
					<button type="button" class="btn  btn-success text-center third_top-time">
						<h3><span>30</span>s</h3>
					</button>
				</div>
				<div id="mission_score_box" class="col-4 text-right">
					<button type="button" class="btn btn-labeled btn-danger">
						<span class="btn-label">任務得分：</span><span id="score">1000</span>
					</button>
				</div>
				<div id="game_score_box" class="col-4 text-right">
					<button type="button" class="btn btn-labeled btn-info">
						<span class="btn-label">遊戲得分：</span><span id="game_score">0</span>
					</button>
				</div>
			</div>
		</div>
	</header>

	<div id="stock">
		
	</div>

	
	<main id="game4" role="main" class="container" >
		<!-- <div class="row">
			<div class="col-12">
				<div class="button text-center">
					<button onClick="startGame()">Replay</button>
				  </div>
			</div>
		</div> -->
		<table>
			<tr>
			  <td class="cell" id="0"></td>
			  <td class="cell" id="1"></td>
			  <td class="cell" id="2"></td>
			  <td class="cell" id="3"></td>
			  <td class="cell" id="4"></td>
			</tr>
			<tr>
			  <td class="cell" id="5"></td>
			  <td class="cell" id="6"></td>
			  <td class="cell" id="7"></td>
			  <td class="cell" id="8"></td>
			  <td class="cell" id="9"></td>
			</tr>
			<tr>
			  <td class="cell" id="10"></td>
			  <td class="cell" id="11"></td>
			  <td class="cell" id="12"></td>
			  <td class="cell" id="13"></td>
			  <td class="cell" id="14"></td>
			</tr>
			 <tr>
			  <td class="cell" id="15"></td>
			  <td class="cell" id="16"></td>
			  <td class="cell" id="17"></td>
			  <td class="cell" id="18"></td>
			  <td class="cell" id="19"></td>
			</tr>
			<tr>
				<td class="cell" id="20"></td>
				<td class="cell" id="21"></td>
				<td class="cell" id="22"></td>
				<td class="cell" id="23"></td>
				<td class="cell" id="24"></td>
			  </tr>
		  </table>
		  <div class="endgame">
			<div class="text"></div>
		  </div>

	</main>

	<div id="game3_popup">
		<div class="container" style="max-width:600px;height:100%;">
			<div class="row align-items-center" style="height:100%;">
				<div class="col-12">
					<div id="game4_popup_img" class="text-center mb-3">
					</div>
					<p id="answer"></p>

					<div class="controls text-center">
						<button id="play" type="submit">聽發音</button>
					</div>
					<div class="game4_title">

					</div>
					<div class="form-item">
						<label>請輸入單字</label>
						<div class="input-wrapper"><input class="game4_input" type="text" name="username" id="username" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" data-lpignore="true" /></div>
					</div>
					<button id="game4_submit">提交答案</button>
					<button id="game4_cancel">放棄</button>
				</div>
			</div>
		</div>
	</div>

	<!--popUp-->
	<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
		  <div class="modal-content">
			<div class="modal-body p-5">
				<div class="wrong_support">

				</div>
				<div class="wrong_support_toggle">
					<div class="row align-items-end">
						<button class="wrong_support_translate_toggle col-4 btn btn-lg shadow-sm btn-outline-success p-5">文章翻譯</button>
						<button class="wrong_support_word_toggle col-4 btn btn-lg shadow-sm btn-outline-success p-5">單字提示</button>
						<button class="wrong_support_clause_toggle col-4 btn btn-lg shadow-sm btn-outline-success p-5">文法提示</button>
					</div>
				</div>
			</div>
			<div class="modal-footer">
			  <button type="button" class="btn btn-secondary next_q" data-dismiss="modal">下一題</button>
			</div>
		  </div>
		</div>
	</div>




	<!--JS-->
	<script type="text/javascript" src="js/jquery.3.2.1min.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>

	<script type="text/javascript" src="js/allv1.js"></script>
	<script type="text/javascript" src="js/allv2.js"></script>
	<script>

  var game3_time = 300;
  var timeCount = $('.third_top-time span'); //倒數計時dom
  timeCount.text(game3_time);
  //第二關遊戲循環倒數
  var interval;
  var intervalCall = function() {
    if (game3_time >= 0) { 
      timeCount.text(game3_time);
      game3_time--
      clearInterval(interval);
      interval = setInterval(intervalCall, 1000);
    }else{
      clearInterval(interval);
      alert("第三關遊戲結束");
      $('#game4').css('display', 'none');
    }
  };
  interval = setInterval(intervalCall, 1000); 
		var origBoard;
		var score = 0
		var targetId = "";
		var game4_answer_voice = "";
		var bingo_line = 0
		const huPlayer = 'O';
		const aiPlayer = 'X';
		const winCombos = [
			[0, 1, 2, 3, 4],
			[5, 6, 7, 8, 9],
			[10, 11, 12, 13, 14],
			[15, 16, 17, 18, 19],
			[20, 21, 22, 23, 24],
			[0, 5, 10, 15, 20],
			[1, 6, 11, 16, 21],
			[2, 7, 12, 17, 22],
			[3, 8, 13, 18, 23],
			[4, 9, 14, 19, 24],
			[0, 6, 12, 18, 24],
			[4, 8, 12, 16, 20]
		];


		var game4Array = [
			{
				img: 'fruit_1.jpg',
				title: '',
				answer: 'banana',
				voice: 'banana'
			},
			{
				img: 'fruit_2.jpg',
				title: '',
				answer: 'kiwi',
				voice: 'kiwi'
			},
			{
				img: 'fruit_3.jpg',
				title: '',
				answer: 'orange',
				voice: 'orange'
			},
			{
				img: 'fruit_4.jpg',
				title: '',
				answer: 'papaya',
				voice: 'papaya'
			},
			{
				img: 'fruit_5.jpg',
				title: '',
				answer: 'pineapple',
				voice: 'pineapple'
			},
			{
				img: 'fruit_6.jpg',
				title: '',
				answer: 'watermelon',
				voice: 'watermelon'
			},
			{
				img: 'fruit_7.jpg',
				title: '',
				answer: 'tomato',
				voice: 'tomato'
			},
			{
				img: 'fruit_8.jpg',
				title: '',
				answer: 'strawberry',
				voice: 'strawberry'
			},
			{
				img: 'fruit_9.jpg',
				title: '',
				answer: 'grapes',
				voice: 'grapes'
			},
			{
				img: 'fruit_10.jpg',
				title: '',
				answer: 'pear',
				voice: 'pear'
			},
			{
				img: 'fruit_11.jpg',
				title: '',
				answer: 'passion fruit',
				voice: 'passion fruit'
			},
			{
				img: 'fruit_12.jpg',
				title: '',
				answer: 'rambutan',
				voice: 'rambutan'
			},
			{
				img: 'fruit_13.jpg',
				title: '',
				answer: 'grapefruit',
				voice: 'grapefruit'
			},
			{
				img: 'fruit_14.jpg',
				title: '',
				answer: 'cantaloupe',
				voice: 'cantaloupe'
			},
			{
				img: 'fruit_15.jpg',
				title: '',
				answer: 'coconut',
				voice: 'coconut'
			},
			{
				img: 'fruit_11.jpg',
				title: '',
				answer: 'passion fruit',
				voice: 'passion fruit'
			},
			{
				img: 'fruit_9.jpg',
				title: '',
				answer: 'grapes',
				voice: 'grapes'
			},
			{
				img: 'fruit_7.jpg',
				title: '',
				answer: 'tomato',
				voice: 'tomato'
			},
			{
				img: 'fruit_6.jpg',
				title: '',
				answer: 'watermelon',
				voice: 'watermelon'
			},
			{
				img: 'fruit_4.jpg',
				title: '',
				answer: 'papaya',
				voice: 'papaya'
			},
			{
				img: 'fruit_15.jpg',
				title: '',
				answer: 'coconut',
				voice: 'coconut'
			},
			{
				img: 'fruit_14.jpg',
				title: '',
				answer: 'cantaloupe',
				voice: 'cantaloupe'
			},
			{
				img: 'fruit_13.jpg',
				title: '',
				answer: 'grapefruit',
				voice: 'grapefruit'
			},
			{
				img: '22.jpg',
				title: 'When John was an __________ ______, he did not like Mary',
				answer: 'elementary student',
				voice: 'When John was an elementary student, he did not like Mary'
			},
			{
				img: '11.jpg',
				title: 'Mary does not study very hard but she can ______ high scores from all tests',
				answer: 'obtain',
				voice: 'Mary does not study very hard but she can obtain high scores from all tests'
			},
		]

		const cells = document.querySelectorAll('.cell');
		startGame();

		function startGame() {
			document.querySelector(".endgame").style.display = "none"
			origBoard = Array.from(Array(25).keys()); //create array 0:0, 1:1, 2:2 ...
			console.log(origBoard)
			for (var i = 0; i < cells.length; i++) {
				// cells[i].innerText = "apple";
				cells[i].innerHTML='<img class="cell_img" id="'+ i + '" src="images/' + game4Array[i].img + '"/>';
				cells[i].style.removeProperty('background-color');
				// cells[i].addEventListener('click', turnClick, false);
			}
			const cells_img = document.querySelectorAll('.cell_img');
			for (var i = 0; i < cells_img.length; i++) {
				cells_img[i].addEventListener('click', turnClick, false);
			}
			$('#bingo_line').html(bingo_line);

		}

		function turnClick(square) {
			targetId = square.target.id
			console.log("square.target.id",targetId);
			$("#game3_popup").css("display","block");
			$('.game4_title').html('<p>'+ game4Array[targetId].title+'</p>')
			$("#game4_popup_img").html('<img  src="images/' + game4Array[targetId].img + '"/>')
			// if (typeof origBoard[square.target.id] == 'number') {
			// 	turn(square.target.id, huPlayer);
			// 	if (!checkTie()) turn(bestSpot(), aiPlayer); 
			// }
		}

		function submitClick(targetId) {
			$("#game3_popup").css("display","none");
			// console.log($("input[type=text][name=username]").val(''))
			console.log(document.getElementById("username").value)
			if (typeof origBoard[targetId] == 'number') {
				turn(targetId, huPlayer);
				if (!checkTie()) turn(bestSpot(), aiPlayer); 
			}
			alert("答題正確")
		}

		function turn(squareId, player) {
			origBoard[squareId] = player;
			document.getElementById(squareId).innerText = player;
			let gameWon = checkWin(origBoard, player);
			// if (gameWon) gameOver(gameWon);
		}

		function checkWin(board, player) {
			console.log(board)
			let plays = board.reduce((a, e, i) =>(e === huPlayer) ? a.concat(i) : a, []); //e:element []:축적할 배열
			console.log("plays",plays)

			
			// let gameWon = null;
			let gameWon = [];
			console.log("winCombos.entries()", winCombos.entries())
			for (let [index, win] of winCombos.entries()) {
				// if (win.every(elem => plays.indexOf(elem) > -1)) {
				// 	gameWon = {index: index, player: player};
				// 	console.log("www",winCombos)
				// 	console.log("gameWon",gameWon)
				// 	break;
				// }

				if (win.every(elem => plays.indexOf(elem) > -1)) {
					var aaa = {
						index: index, player: huPlayer
					}
					gameWon.push(aaa)
					console.log("gameWongameWongameWon",gameWon)
					for (var i = 0; i < winCombos[index].length; i++) {
						var bbb = winCombos[index][i]
						document.getElementById(bbb).style.backgroundColor = "blue"
					}

					// gameWon = {index: index, player: huPlayer};
					score += 50
					bingo_line ++
					$('#game_score').html(score);
					$('#bingo_line').html(bingo_line);
					winCombos.splice(index, 1);
					console.log("www",winCombos);
					console.log("score",score);
					// return gameWon;
				}
			}
			// if(plays.length==8){
			// 	console.log("gameWongameWongameWongameWon",gameWon)
			// 	return gameWon;
			// }
			// console.log("gameWon",gameWon)
			// return gameWon;
			// return 111
		}

		function gameOver(gameWon) {
			console.log("gameWongameWongameWongameWon",gameWon)
			for (let index of winCombos[gameWon.index]) {
				document.getElementById(index).style.backgroundColor = gameWon.player == huPlayer ? "blue" : "red";
			}
			for(var i = 0; i < cells.length; i++) {
				cells[i].removeEventListener('click', turnClick, false);
			}
			declareWinner(gameWon.player == huPlayer ? "闖關成功!" : "闖關失敗!");
		}

		function declareWinner(who) {
			document.querySelector(".endgame").style.display = "block";
			document.querySelector(".endgame .text").innerText = who;
		}

		function emptySquares() {
			return origBoard.filter(s => typeof s == 'number');
		}

		function bestSpot() {
			return emptySquares()[0];
		}

		function checkTie() {
		// if (emptySquares().length == 0) {
		// 	for (var i = 0; i < cells.length; i++) {
		// 		cells[i].style.backgroundColor = "green";
		// 		cells[i].removeEventListener('click', turnClick, false);
		// 	}
		// 	declareWinner("Tie Game!");
		// 	return true;
		// }
		return false;
		}


		$('#game4_cancel').on( "click", function() {
			$("#game3_popup").css("display","none");
		});

		$('#game4_submit').on( "click", function() {
			if($("input[type=text][name=username]").val()===game4Array[targetId].answer){
				$("input[type=text][name=username]").val('')
				submitClick(targetId)
				$("#game3_popup").css("display","none");
			}else{
				$("input[type=text][name=username]").val('')
				alert("答題錯誤")
			}
		});

		var synth = window.speechSynthesis;

		var inputForm = document.querySelector('form');
		var inputTxt = document.getElementById("answer");

		var voices = [];
		function populateVoiceList() {
			voices = synth.getVoices().sort(function (a, b) {
				const aname = a.name.toUpperCase(), bname = b.name.toUpperCase();
				if ( aname < bname ) return -1;
				else if ( aname == bname ) return 0;
				else return +1;
			});
		}

		populateVoiceList();
		if (speechSynthesis.onvoiceschanged !== undefined) {
			speechSynthesis.onvoiceschanged = populateVoiceList;
		}
		function speak(){
			if (synth.speaking) {
				console.error('speechSynthesis.speaking');
				return;
			}
			if (inputTxt.value !== '') {
				var utterThis = new SpeechSynthesisUtterance(game4_answer_voice);
				utterThis.onend = function (event) {
					console.log('SpeechSynthesisUtterance.onend');
				}
				utterThis.onerror = function (event) {
					console.error('SpeechSynthesisUtterance.onerror');
				}

				utterThis.voice = voices[20];
				utterThis.pitch = 1;
				utterThis.rate = 0.7;
				synth.speak(utterThis);
			}
		}		

		$('#play').on( "click", function(e) {
			game4_answer_voice = game4Array[targetId].voice
			e.preventDefault();

			speak();

			$("input[type=text][name=username]").blur();
		});
	

		// $(document).keydown(function (event) {
		// 	if (event.keyCode == 123) { // Prevent F12
		// 		return false;
		// 	} else if (event.ctrlKey && event.shiftKey && event.keyCode == 73) { // Prevent Ctrl+Shift+I        
		// 		return false;
		// 	}
		// });

var elem = document.getElementById("myvideo");
function openFullscreen() {
  if (elem.requestFullscreen) {
    elem.requestFullscreen();
  } else if (elem.mozRequestFullScreen) { /* Firefox */
    elem.mozRequestFullScreen();
  } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
    elem.webkitRequestFullscreen();
  } else if (elem.msRequestFullscreen) { /* IE/Edge */
    elem.msRequestFullscreen();
  }
}
// addEventListener("click", function() {
//     var
//           el = document.documentElement
//         , rfs =
//                el.requestFullScreen
//             || el.webkitRequestFullScreen
//             || el.mozRequestFullScreen
//     ;
//     rfs.call(el);
// });
	</script>
</body>

</html>